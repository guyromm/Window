<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Model Perspective Box</title>
    <link rel="stylesheet" href="glb-demo.css">
</head>
<body>
    <!-- Main WebGL canvas -->
    <canvas id="glCanvas"></canvas>

    <!-- Video element for head tracking (hidden) -->
    <video id="video" style="display: none;"></video>

    <!-- Canvas overlay for face detection visualization -->
    <canvas id="canvas-overlay"></canvas>

    <!-- Isometric debug view -->
    <canvas id="isometric-debug" width="400" height="400"></canvas>

    <!-- Control panel -->
    <div id="controls">
        <h3>GLB Model Viewer</h3>

        <div class="control-group">
            <label for="modelFile">Load GLB:</label>
            <input type="file" id="modelFile" accept=".glb,.gltf">
            <div id="modelStatus">Loading: dodge_charger_with_doors_open.glb</div>
        </div>

        <div class="control-group">
            <h4>Model Controls</h4>
            <label>Scale: <input type="number" id="modelScale" min="0.01" max="10" step="0.01" value="1" style="width: 80px"></label>
            <br>
            <label>Rotate Y: <input type="range" id="modelRotation" min="0" max="360" step="1" value="270"></label>
            <span id="rotationValue">270Â°</span>
            <br>
            <label>Position X: <input type="range" id="modelX" min="-50" max="50" step="1" value="0"></label>
            <br>
            <label>Position Y: <input type="range" id="modelY" min="-30" max="30" step="0.5" value="0"></label>
            <br>
            <label>Position Z: <input type="range" id="modelZ" min="-30" max="0" step="1" value="-15"></label>
        </div>

        <div class="control-group">
            <h4>Head Tracking</h4>
            <button id="trackingBtn">Start Head Tracking</button>
            <div>Status: <span id="trackingStatus">Off</span></div>
            <div>Face Detected: <span id="faceDetected">No</span></div>
            <button id="calibrateBtn" onclick="calibrateDistance()">Calibrate Distance</button>
            <div>Head Position:</div>
            <div>X: <span id="headX">0</span> cm</div>
            <div>Y: <span id="headY">0</span> cm</div>
            <div>Z: <span id="headZ">40</span> cm</div>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="interlacedMode" onchange="toggleInterlacedMode()">
                Interlaced Stereo Mode
            </label>
        </div>

        <div class="control-group">
            <h4>Lighting</h4>
            <label>Ambient: <input type="range" id="ambientLight" min="0" max="1" step="0.1" value="0.3"></label>
            <br>
            <label>Directional: <input type="range" id="directionalLight" min="0" max="2" step="0.1" value="1"></label>
        </div>
    </div>

    <!-- Load Three.js from CDN -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
        }
    }
    </script>

    <!-- Load MediaPipe for face detection -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <!-- Main application script -->
    <script type="module" src="glb-demo.js"></script>
</body>
</html>